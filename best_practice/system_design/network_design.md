# ネットワーク

■127.0.0.1と0.0.0.0の違い

- 127.0.0.1：ローカルループパブリックという、そのコンピュータ内でのみアクセス可能なネットワークインタフェース。  
&nbsp;同じコンピューター内からはアクセスできるが、コンピューター外からはアクセスできない。
- バインド：「127.0.0.1:8000を使う」こと。
- コンピューター外と直接通信するには、コンピューター外との通信用ネットワークインタフェースのIPにバインドして起動する。  
&nbsp;例)python manage.py runserver 192.168.99.1:8000(0.0.0.0:8000はグローバル通信)

ネットワークインタフェースの一覧はifconfigやip addrコマンドで確認できる。それぞれloやeth0といった名前である。  
外部からアクセス可能にするには、eth0などのコンピューター外部と繋がっているネットワークインタフェースのIPアドレスを調べて、  
そのIPアドレスにバインドする。  

- 0.0.0.0は想定外の誰かが、アクセスしてwebアプリを見られてしまう必要があるため、外部からのアクセス制限がされている  
&nbsp;開発サーバーや仮想マシン内で使用し、個人端末では、本当に必要な時だけ指定するようにする。

■リバースプロキシ

- リバースプロキシ：webサーバーで受け取ったリクエストをバックエンドのGunicornに渡すフロントのwebサーバー。  
&nbsp;インターネットではwebサイトに対してロングポーリングや巨大なリクエストを送りつけるといった多種多様な攻撃が日々繰り返されており、  
&nbsp;こういった攻撃に対する仕組みはGunicornやDjangoでは提供されていない。
- プロキシサーバー：受け取ったリクエストを他のサーバーに転送するサーバーのこと。
- webサーバーとしてApacheやNginxなどを設置し、webアプリケーションサーバーにリバースプロキシで接続する。
- ヘッダーについている「X-」は独自仕様という意味。

■Unixドメインソケット

- webサーバーとwebアプリケーションサーバーの通信方式を合わせる。可能ならTCPよりも高速なUnixドメインソケットによる  
&nbsp;リバースプロキシ接続を行う。
- Unixドメインソケットによる通信では、ファイルパスで通信を行う。  
&nbsp;例) gunicorn -b unix:/var/run/gunicorn.sock apps.wsgi.application

■不正なドメイン名でのアクセスを拒否する

- 不正なドメイン名でのアクセスを拒否するように、webサーバーの名前ベースのバーチャルホストを設定する。  

例)  

```
server {
    listen 80 default_server;
    return 444;
}

server{
    listen 80;
    server_name app.example.com;
    location /{
        proxy_pass http://webapp:8000/;
    }
}
```
- この設定ではlisten 80 default_serverという設定を持ったserverディレクティブを追加して、不正なドメイン名へのアクセスを全て  
&nbsp;受信するようにしている。そしてreturn 444;によってNginxがリクエスト元にレスポンスを返さずに即座に通信を切断するように指示している。  
&nbsp;これによって、不正なリクエストがwebサーバーへ届かないようになっている。

- Firefoxはproxy通信設定がOSの設定から独立しているため、一時的な開発用途でのproxyの設定変更であればFirefoxを利用する。