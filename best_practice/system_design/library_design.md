# ライブラリ設計

■要件から適切なライブラリを選ぶ

- 要件をリスト化して本当にそれが必要なのか、ライブラリを使わずに済ませる方法がないのか吟味する。
- 同じような要件の先行事例を探す。
- 長年よく使われているポピュラーな枯れているライブラリを使用すると新しいライブラリより安定している。

■バージョンをいつ上げるか

- フレームワーク
    - DjangoやCeleryといった機能や影響が大きいフレームワークの場合、パッチバージョンの適用はこまめに行う。(軽微な更新は影響範囲が小さいため)
- フレームワーク以外のライブラリ
    - 多くのOSSライブラリは過去バージョンのバグ修正やセキュリティー更新を提供していないため、セキュリティー更新は最新バージョンとして提供される。  
    &nbsp;もし固定しているバージョンと最新バージョンとでAPIの互換性がない場合、セキュリティー更新を適用するためにはAPI変更の対応も必要になり、  
    &nbsp;リリースまで時間がかかる。このため、1年に一回など、定期的にバージョンを更新していくのが良い。

- バージョン更新の確認方法
```
pip list -o
```

- githubのセキュリティ脆弱性アラートを使えば、requirements.txt等に記載されたpythonライブラリのバージョンをチェックして、  
nbsp;セキュリティー上必要な更新があることを教えてくれる。

■SQLAlchemyのクエリビルダーを利用する

- SQLを文字列で組み立てる必要があると考えた場合は、SQLAlchemyも検討する。  
&nbsp;SQLAlchemyはORMも提供するが、クエリビルダー(SQLAlchemy Core)も提供している。このクエリビルダーを使えば、  
&nbsp;SQLを文字列で組み立てるよりも安全にクエリを用意できる。またSQLAlchemyがサポートする複数のDBエンジン向けにSQL生成  
&nbsp;可能なため、DBエンジン依存を最小限にできる。