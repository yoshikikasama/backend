# ライブラリ設計

■ 要件から適切なライブラリを選ぶ

- 要件をリスト化して本当にそれが必要なのか、ライブラリを使わずに済ませる方法がないのか吟味する。
- 同じような要件の先行事例を探す。
- 長年よく使われているポピュラーな枯れているライブラリを使用すると新しいライブラリより安定している。

■ バージョンをいつ上げるか

- フレームワーク
  - Django や Celery といった機能や影響が大きいフレームワークの場合、パッチバージョンの適用はこまめに行う。(軽微な更新は影響範囲が小さいため)
  - パッチバージョン: 2.2.8 → 2.2.9。軽微なバグ修正など。
  - マイナーバージョン: 2.1 → 2.2。機能変更あり
  - メジャーバージョン: 2.1 → 3.1。機能変更あり
- フレームワーク以外のライブラリ

  - 多くの OSS ライブラリは過去バージョンのバグ修正やセキュリティー更新を提供していないため、セキュリティー更新は最新バージョンとして提供される。
    - もし固定しているバージョンと最新バージョンとで API の互換性がない場合、セキュリティー更新を適用するためには API 変更の対応も必要になり、
    - リリースまで時間がかかる。このため、1 年に一回など、定期的にバージョンを更新していくのが良い。

- バージョン更新の確認方法

```
pip list -o
```

- github のセキュリティ脆弱性アラートを使えば、requirements.txt 等に記載された python ライブラリのバージョンをチェックして、セキュリティー上必要な更新があることを教えてくれる。

■SQLAlchemy のクエリビルダーを利用する

- SQL を文字列で組み立てる必要があると考えた場合は、SQLAlchemy も検討する。
  - SQLAlchemy は ORM も提供するが、クエリビルダー(SQLAlchemy Core)も提供している。このクエリビルダーを使えば、
  - SQL を文字列で組み立てるよりも安全にクエリを用意できる。また SQLAlchemy がサポートする複数の DB エンジン向けに SQL 生成
  - 可能なため、DB エンジン依存を最小限にできる。
  - https://www.ipa.go.jp/security/vuln/websecurity/about.html
