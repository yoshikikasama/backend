# サーバー構成

■ 共有ストレージを用意する

-クラウドのストレージを用意して運用する。

■ ファイルを CDN から配信する

- CDN(Content Delivery Network)・・・全世界に用意したサーバー群に対象となる静的ファイルのコピー(キャッシュ)を持たせ、ユーザーにとって一番近いところからコンテンツを配信することで、誰がどこからアクセスしても一律同程度の速さでコンテンツを取得できるもの。
  - https://blog.redbox.ne.jp/what-is-cdn.html

■KVS を利用する

- KVS(Key Value Store)・・・Key とそれに紐づく値を管理するデータストア。高速にデータの読み書きができるので、アプリケーションのキャッシュに利用される。

■ 時間のかかる処理は非同期化する

リアルタイムでの処理が必要のない部分で時間がかかる場合、非同期化を検討する。例えば、メールの送信や、外部システムへの通信など。  
実装方法は python では以下の方法がある。

- ThreadPoolExecutor 等を用いて別スレッドで処理する
- asyncio を利用する
- Celery などのジョブキューシステムを利用する
  - ジョブキューシステム： 何かしらのジョブという単位で管理して、それをキューに積んでおき、後でキューから 1 つずつジョブを取り出して実行していくシステムのこと。

■ タスク非同期処理

Gunicorn のような web アプリケーションのプロセスは、複数のレスポンスを扱うための機能を提供するマルチプロセス、 マルチスレッドが使われている。  
Gunicorn の場合、一定数のリクエストを処理する毎にワーカープロセスが再起動される設定がある。  
意図しないタイミングで再起動されると、スレットでの処理が最後まで行われなかったり、スレッドがワーカープロセスの再起動を妨げたりといった意図しない動作を引き起こす。

- 非同期タスク処理は定番フレームワークを検討する。
  - Celery: RDB だけではなく、メッセージブローカー用のミドルウェアも必要になる。
  - Django Background Tasks: json 形式、ミドルウェア追加不要で、既存の RDB だけで非同期処理を実現できる。
  - APScheduler: ミドルウェア追加不要。
