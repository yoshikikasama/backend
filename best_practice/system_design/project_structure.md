# プロジェクト構成

■ 本番環境はシンプルな仕組みで構築する

- 複雑な機能の package で構築してトラブル解決に時間がかかってはいけないので、シンプルな環境、仕組みで揃えるようにする。
- web アプリケーションの本番環境で使われる、代表的な組み合わせ 2 つ。単機能で仕組みの理解が簡単でセキュリティー更新が適用しやすい。
  - OS が提供する Python + venv + pip
  - 公式 Docker イメージ + pip

python のバージョンを合わせることも重要。そうすることで、本番環境と結合テストなどの差異で出る不具合を避けられる。

■OS が提供する Python を使う

Ubuntu であれば、apt でインストールできる公式の Python, RedHat Enterprise Linux であれば、yum や dnf でインストールできる Python。

- メリット
  - セキュリティー更新情報が発信される
  - セキュリティー更新があることが apt や yum コマンドでわかるようになっている
  - 更新の適用と互換性の確認コストが低い、更新パッチが配布されていて、互換性が維持される。
- デメリット
  - Python の最新バージョンを使用できない。

■OS 標準以外の Python を使う

Anaconda や pyenv など、Python をインストールする。

- メリット
  - Python の好きなバージョン、配布元を選べる
  - セキュリティー更新の確認は独自に行う
- デメリット
  - 再インストールと動作確認が必要なため、更新の適用と互換性の確認コストが高い。

■Docker 公式の Python を使う

- メリット
  - Python の好きなバージョンを選べる
- デメリット
  - セキュリティの更新は各自で行う。
  - 更新の適用と互換性の確認コストが低〜中程度。コンテナの入れ替え、差分の影響確認が必要。

■ リポジトリのルートディレクトリはシンプルに構成する

リポジトリのルートディレクトリは、リポジトリの主目的にあった、見た人に注目してほしいファイルやディレクトリだけをおく。

- ルートディレクトリにある次のファイル名やディレクトリ名から、次のような状況が類推できる
  - .circleci や.travis.yml: CI サービスで自動テストなどが設定されている
  - .env: 環境変数による環境別設定の切り替えに対応している
  - CHANGELOG や changelog/: リリースごとの変更履歴を管理している
  - Dockerfile: アプリ実行用の Docker Image が公開されている
  - LICENCE: 使用許可。利用時の条件が記載されている
  - Vagrantfile や docker-compose.yml: OS を含むアプリ実行用の環境用意が手軽に行える
  - manage.py: Django アプリの開発プロジェクト
  - package.json: Javascript アプリの開発プロジェクト
  - requirements.txt や pipfile: アプリ実行用の Python パッケージインストールが手軽に行える
  - setup.py: Python の配布用パッケージのプロジェクト
  - pyproject.toml: Python の配布用パッケージのプロジェクト
  - tox.ini: Python のプロジェクトの自動テストコマンドがまとめられている
- makefile: 実行したいコマンドを定義(https://riririririn.hatenablog.com/entry/2021/11/29/Python%E3%81%A7makefile%E3%82%92%E4%BD%9C%E3%82%8B%EF%BD%9C%E5%A5%B3%E5%AD%90%E5%A4%A7%E7%94%9F%E3%82%A8%E3%83%B3%E3%82%B8%E3%83%8B%E3%82%A2%E3%81%AE%E5%82%99%E5%BF%98%E9%8C%B2_%233)

■ 設定ファイルを環境別に分割する

- 環境別設定のために設定ファイルを共通部分と環境依存部分に分割する。以下、Django の例
  - base.py: 環境で共通部分をまとめた。
  - local.py: ローカル環境用の設定ファイル。
  - staging.py: 実際にサービスを提供する環境とほぼ同じ環境にシステムを反映させ、動作確認する環境
  - production.py: 本番環境。実際にユーザーが利用する環境。
  - test.py: 自動テスト時に使用する環境。
