# プロジェクト構成

■本番環境はシンプルな仕組みで構築する

- webアプリケーションの本番環境で使われる、代表的な組み合わせ2つ
    - OSが提供するPython + venv + pip
    - 公式Dockerイメージ + pip

pythonのバージョンを合わせることも重要。そうすることで、本番環境と結合テストなどの差異で出る不具合を避けられる。

■OSが提供するPythonを使う

Ubuntuであれば、aptでインストールできる公式のPython, RedHat Enterprise Linuxであれば、yumやdnfでインストールできるPython。

- メリット
    - セキュリティー更新情報が発信される
    - セキュリティー更新があることがaptやyumコマンドでわかるようになっている
    - 更新の適用と互換性の確認コストが低い、更新パッチが配布されていて、互換性が維持される。
- デメリット
    - Pythonの最新バージョンを使用できない。

■OS標準以外のPythonを使う

Anacondaやpyenvなど、Pythonをインストールする。

- メリット
    - Pythonの好きなバージョン、配布元を選べる
    - セキュリティー更新の確認は独自に行う
- デメリット
    - 再インストールと動作確認が必要なため、更新の適用と互換性の確認コストが高い。

■Docker公式のPythonを使う

- メリット
    - Pythonの好きなバージョンを選べる
- デメリット
    - セキュリティの更新は各自で行う。
    - 更新の適用と互換性の確認コストが低〜中程度。コンテナの入れ替え、差分の影響確認が必要。

■リポジトリのルートディレクトリはシンプルに構成する

リポジトリのルートディレクトリは、リポジトリの主目的にあった、見た人に注目してほしいファイルやディレクトリだけをおく。

- ルートディレクトリにある次のファイル名やディレクトリ名から、次のような状況が類推できる
    - .circleciや.travis.yml: CIサービスで自動テストなどが設定されている
    - .env: 環境変数による環境別設定の切り替えに対応している
    - CHANGELOGやchangelog/: リリースごとの変更履歴を管理している
    - Dockerfile: アプリ実行用のDocker Imageが公開されている
    - LICENCE: 使用許可。利用時の条件が記載されている
    - Vagrantfileやdocker-compose.yml: OSを含むアプリ実行用の環境用意が手軽に行える
    - manage.py: Djangoアプリの開発プロジェクト
    - package.json: Javascriptアプリの開発プロジェクト
    - requirements.txtやpipfile: アプリ実行用のPythonパッケージインストールが手軽に行える
    - setup.py: Pythonの配布用パッケージのプロジェクト
    - pyproject.toml: Pythonの配布用パッケージのプロジェクト
    - tox.ini: Pythonのプロジェクトの自動テストコマンドがまとめられている

■設定ファイルを環境別に分割する

- 環境別設定のために設定ファイルを共通部分と環境依存部分に分割する。  
    - base.py: 共通部分をまとめた。
    - local.py: ローカルでの動作。
    - staging.py: 実際にサービスを提供する環境とほぼ同じ環境にシステムを反映させ、動作確認する環境
    - production.py: 本番環境。実際にユーザーが利用する環境。
    - test.py: 自動テスト時に使用する環境。